{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams}from\"react-router-dom\";// üì• Importamos el componente de resumen del pago (aseg√∫rate que la ruta sea correcta)\nimport ResumenPago from\"./ResumenPago\";// ajusta la ruta si est√° en otra carpeta\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EstadoPago=()=>{const{reference}=useParams();// üì¶ Capturamos la referencia desde la URL\nconst[estado,setEstado]=useState(null);// üîÅ Estado actual del pago\nconst[ultimaConsulta,setUltimaConsulta]=useState(null);// üïì Timestamp del √∫ltimo polling\nconst[errorConsulta,setErrorConsulta]=useState(false);// ‚ö†Ô∏è Si ocurre un error en la consulta\nuseEffect(()=>{let intervalo;let delayInicial;// üîç Funci√≥n que consulta al backend por el estado del pago\nconst consultarEstado=async()=>{try{const res=await fetch(\"http://localhost:3000/pago/\".concat(reference));if(!res.ok){if(res.status===404)setEstado(\"NO_ENCONTRADO\");else setErrorConsulta(true);clearInterval(intervalo);return;}const data=await res.json();setEstado(data.status);setUltimaConsulta(new Date().toLocaleTimeString());if(data.status!==\"PENDING\")clearInterval(intervalo);}catch(error){console.error(\"‚ùå Error en la consulta:\",error);setErrorConsulta(true);clearInterval(intervalo);}};// ‚è±Ô∏è Iniciamos la primera consulta con un delay para evitar conflictos con el guardado en MongoDB\ndelayInicial=setTimeout(()=>{consultarEstado();intervalo=setInterval(consultarEstado,3000);// üîÅ Polling cada 3 segundos\n},1500);// üßº Cleanup al desmontar el componente\nreturn()=>{clearInterval(intervalo);clearTimeout(delayInicial);};},[reference]);// üé® Visualizaci√≥n seg√∫n estado del pago\nconst renderEstado=()=>{if(errorConsulta){return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"crimson\"},children:\"\\uD83D\\uDEA8 Error al consultar el estado del pago\"});}switch(estado){case\"APPROVED\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"green\"},children:\"\\uD83C\\uDF89 \\xA1Pago aprobado!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Gracias por tu compra.\"}),/*#__PURE__*/_jsx(ResumenPago,{reference:reference})]});case\"DECLINED\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"red\"},children:\"\\u274C Transacci\\xF3n rechazada\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Por favor intenta nuevamente con otro banco.\"})]});case\"PENDING\":return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"orange\"},children:\"\\u23F3 Esperando confirmaci\\xF3n del banco\\u2026\"});case\"NO_ENCONTRADO\":return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"gray\"},children:\"\\u26A0\\uFE0F Referencia no encontrada\"});case null:return/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDD0D Consultando estado del pago\\u2026\"});default:return/*#__PURE__*/_jsxs(\"h2\",{style:{color:\"gray\"},children:[\"\\uD83D\\uDCCC Estado desconocido: \",estado]});}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"2rem\",textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83E\\uDDFE Estado del Pago\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Referencia: \",/*#__PURE__*/_jsx(\"strong\",{children:reference})]}),/*#__PURE__*/_jsx(\"div\",{\"aria-live\":\"polite\",role:\"status\",children:renderEstado()}),ultimaConsulta&&/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:\"0.85rem\",color:\"#666\",marginTop:\"0.5rem\"},children:[\"\\xDAltima verificaci\\xF3n: \",ultimaConsulta]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.href=\"/\",style:{marginTop:\"1.5rem\",padding:\"10px 20px\",cursor:\"pointer\"},children:\"\\uD83D\\uDD19 Volver a la tienda\"})]});};export default EstadoPago;","map":{"version":3,"names":["React","useEffect","useState","useParams","ResumenPago","jsx","_jsx","jsxs","_jsxs","EstadoPago","reference","estado","setEstado","ultimaConsulta","setUltimaConsulta","errorConsulta","setErrorConsulta","intervalo","delayInicial","consultarEstado","res","fetch","concat","ok","status","clearInterval","data","json","Date","toLocaleTimeString","error","console","setTimeout","setInterval","clearTimeout","renderEstado","style","color","children","padding","textAlign","role","fontSize","marginTop","onClick","window","location","href","cursor"],"sources":["C:/Users/David/Desktop/mi-proyecto/frontend/src/components/EstadoPago.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useParams } from \"react-router-dom\";\r\n\r\n// üì• Importamos el componente de resumen del pago (aseg√∫rate que la ruta sea correcta)\r\nimport ResumenPago from \"./ResumenPago\"; // ajusta la ruta si est√° en otra carpeta\r\n\r\nconst EstadoPago = () => {\r\n  const { reference } = useParams(); // üì¶ Capturamos la referencia desde la URL\r\n  const [estado, setEstado] = useState(null); // üîÅ Estado actual del pago\r\n  const [ultimaConsulta, setUltimaConsulta] = useState(null); // üïì Timestamp del √∫ltimo polling\r\n  const [errorConsulta, setErrorConsulta] = useState(false); // ‚ö†Ô∏è Si ocurre un error en la consulta\r\n\r\n  useEffect(() => {\r\n    let intervalo;\r\n    let delayInicial;\r\n\r\n    // üîç Funci√≥n que consulta al backend por el estado del pago\r\n    const consultarEstado = async () => {\r\n      try {\r\n        const res = await fetch(`http://localhost:3000/pago/${reference}`);\r\n        if (!res.ok) {\r\n          if (res.status === 404) setEstado(\"NO_ENCONTRADO\");\r\n          else setErrorConsulta(true);\r\n          clearInterval(intervalo);\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n        setEstado(data.status);\r\n        setUltimaConsulta(new Date().toLocaleTimeString());\r\n        if (data.status !== \"PENDING\") clearInterval(intervalo);\r\n      } catch (error) {\r\n        console.error(\"‚ùå Error en la consulta:\", error);\r\n        setErrorConsulta(true);\r\n        clearInterval(intervalo);\r\n      }\r\n    };\r\n\r\n    // ‚è±Ô∏è Iniciamos la primera consulta con un delay para evitar conflictos con el guardado en MongoDB\r\n    delayInicial = setTimeout(() => {\r\n      consultarEstado();\r\n      intervalo = setInterval(consultarEstado, 3000); // üîÅ Polling cada 3 segundos\r\n    }, 1500);\r\n\r\n    // üßº Cleanup al desmontar el componente\r\n    return () => {\r\n      clearInterval(intervalo);\r\n      clearTimeout(delayInicial);\r\n    };\r\n  }, [reference]);\r\n\r\n  // üé® Visualizaci√≥n seg√∫n estado del pago\r\n  const renderEstado = () => {\r\n    if (errorConsulta) {\r\n      return <h2 style={{ color: \"crimson\" }}>üö® Error al consultar el estado del pago</h2>;\r\n    }\r\n\r\n    switch (estado) {\r\n      case \"APPROVED\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"green\" }}>üéâ ¬°Pago aprobado!</h2>\r\n            <p>Gracias por tu compra.</p>\r\n            {/* üßæ Resumen detallado de la transacci√≥n */}\r\n            <ResumenPago reference={reference} />\r\n          </div>\r\n        );\r\n\r\n      case \"DECLINED\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"red\" }}>‚ùå Transacci√≥n rechazada</h2>\r\n            <p>Por favor intenta nuevamente con otro banco.</p>\r\n          </div>\r\n        );\r\n\r\n      case \"PENDING\":\r\n        return <h2 style={{ color: \"orange\" }}>‚è≥ Esperando confirmaci√≥n del banco‚Ä¶</h2>;\r\n\r\n      case \"NO_ENCONTRADO\":\r\n        return <h2 style={{ color: \"gray\" }}>‚ö†Ô∏è Referencia no encontrada</h2>;\r\n\r\n      case null:\r\n        return <h2>üîç Consultando estado del pago‚Ä¶</h2>;\r\n\r\n      default:\r\n        return <h2 style={{ color: \"gray\" }}>üìå Estado desconocido: {estado}</h2>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: \"2rem\", textAlign: \"center\" }}>\r\n      <h1>üßæ Estado del Pago</h1>\r\n      <p>Referencia: <strong>{reference}</strong></p>\r\n\r\n      {/* ‚ôø Zona que se actualiza din√°micamente */}\r\n      <div aria-live=\"polite\" role=\"status\">\r\n        {renderEstado()}\r\n      </div>\r\n\r\n      {/* üïì Timestamp √∫til para debug o UX */}\r\n      {ultimaConsulta && (\r\n        <p style={{ fontSize: \"0.85rem\", color: \"#666\", marginTop: \"0.5rem\" }}>\r\n          √öltima verificaci√≥n: {ultimaConsulta}\r\n        </p>\r\n      )}\r\n\r\n      {/* üîÅ Acci√≥n para volver a la tienda */}\r\n      <button\r\n        onClick={() => window.location.href = \"/\"}\r\n        style={{\r\n          marginTop: \"1.5rem\",\r\n          padding: \"10px 20px\",\r\n          cursor: \"pointer\"\r\n        }}\r\n      >\r\n        üîô Volver a la tienda\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EstadoPago;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}