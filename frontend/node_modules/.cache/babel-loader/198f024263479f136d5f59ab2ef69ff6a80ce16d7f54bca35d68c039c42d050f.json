{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import{toast}from\"react-toastify\";import ResumenPago from\"./ResumenPago\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EstadoPago=_ref=>{let{apiUrl}=_ref;const{reference}=useParams();const navigate=useNavigate();const[estado,setEstado]=useState(null);const[ultimaConsulta,setUltimaConsulta]=useState(null);const[errorConsulta,setErrorConsulta]=useState(false);const[pago,setPago]=useState(null);useEffect(()=>{if(!apiUrl||!reference){console.warn(\"⚠️ apiUrl o reference no están definidos en EstadoPago\");return;}let intervalo;let delayInicial;const consultarEstado=async()=>{try{const res=await fetch(\"\".concat(apiUrl,\"/pago/\").concat(reference));if(!res.ok){if(res.status===404){setEstado(\"NO_ENCONTRADO\");toast.warn(\"⚠️ Referencia no encontrada\");}else{setErrorConsulta(true);toast.error(\"❌ Error al consultar el estado del pago\");}clearInterval(intervalo);return;}const data=await res.json();console.log(\"📥 Estado del pago:\",data.status);console.log(\"🧾 Detalles del pago:\",data);setEstado(data.status);setPago(data);setUltimaConsulta(new Date().toLocaleTimeString());if(data.status!==\"PENDING\"){clearInterval(intervalo);}// ✅ Toast según estado\nif(data.status===\"APPROVED\"){toast.success(\"✅ Pago aprobado\");}else if(data.status===\"DECLINED\"){toast.error(\"❌ Pago rechazado\");}else if(data.status===\"PENDING\"){toast.info(\"⏳ Pago en proceso\");}}catch(error){console.error(\"❌ Error en la consulta:\",error);setErrorConsulta(true);toast.error(\"❌ Error al consultar el estado del pago\");clearInterval(intervalo);}};delayInicial=setTimeout(()=>{consultarEstado();intervalo=setInterval(consultarEstado,3000);},1500);return()=>{clearInterval(intervalo);clearTimeout(delayInicial);};},[reference,apiUrl]);const renderEstado=()=>{if(errorConsulta){return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"crimson\"},children:\"\\uD83D\\uDEA8 Error al consultar el estado del pago\"});}switch(estado){case\"APPROVED\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"green\"},children:\"\\uD83C\\uDF89 \\xA1Pago aprobado!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Gracias por tu compra.\"}),/*#__PURE__*/_jsx(ResumenPago,{pago:pago})]});case\"DECLINED\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"red\"},children:\"\\u274C Transacci\\xF3n rechazada\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Por favor intenta nuevamente con otro banco.\"})]});case\"PENDING\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"orange\"},children:\"\\u23F3 Esperando confirmaci\\xF3n del banco\\u2026\"}),/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",style:{margin:\"1rem auto\",width:\"40px\",height:\"40px\",border:\"4px solid #ccc\",borderTop:\"4px solid orange\",borderRadius:\"50%\",animation:\"spin 1s linear infinite\"}})]});case\"NO_ENCONTRADO\":return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"gray\"},children:\"\\u26A0\\uFE0F Referencia no encontrada\"});case null:return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDD0D Consultando estado del pago\\u2026\"}),/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})]});default:return/*#__PURE__*/_jsxs(\"h2\",{style:{color:\"gray\"},children:[\"\\uD83D\\uDCCC Estado desconocido: \",estado]});}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"2rem\",textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83E\\uDDFE Estado del Pago\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Referencia: \",/*#__PURE__*/_jsx(\"strong\",{children:reference})]}),/*#__PURE__*/_jsx(\"div\",{\"aria-live\":\"polite\",role:\"status\",children:renderEstado()}),ultimaConsulta&&/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:\"0.85rem\",color:\"#666\",marginTop:\"0.5rem\"},children:[\"\\xDAltima verificaci\\xF3n: \",ultimaConsulta]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/\"),style:{marginTop:\"1.5rem\",padding:\"10px 20px\",cursor:\"pointer\"},children:\"\\uD83D\\uDD19 Volver a la tienda\"}),/*#__PURE__*/_jsx(\"style\",{children:\"\\n        @keyframes spin {\\n          0% { transform: rotate(0deg); }\\n          100% { transform: rotate(360deg); }\\n        }\\n      \"})]});};export default EstadoPago;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","toast","ResumenPago","jsx","_jsx","jsxs","_jsxs","EstadoPago","_ref","apiUrl","reference","navigate","estado","setEstado","ultimaConsulta","setUltimaConsulta","errorConsulta","setErrorConsulta","pago","setPago","console","warn","intervalo","delayInicial","consultarEstado","res","fetch","concat","ok","status","error","clearInterval","data","json","log","Date","toLocaleTimeString","success","info","setTimeout","setInterval","clearTimeout","renderEstado","style","color","children","className","margin","width","height","border","borderTop","borderRadius","animation","padding","textAlign","role","fontSize","marginTop","onClick","cursor"],"sources":["C:/Users/David/Desktop/mi-proyecto/frontend/src/components/EstadoPago.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { toast } from \"react-toastify\";\r\nimport ResumenPago from \"./ResumenPago\";\r\n\r\nconst EstadoPago = ({ apiUrl }) => {\r\n  const { reference } = useParams();\r\n  const navigate = useNavigate();\r\n  const [estado, setEstado] = useState(null);\r\n  const [ultimaConsulta, setUltimaConsulta] = useState(null);\r\n  const [errorConsulta, setErrorConsulta] = useState(false);\r\n  const [pago, setPago] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (!apiUrl || !reference) {\r\n      console.warn(\"⚠️ apiUrl o reference no están definidos en EstadoPago\");\r\n      return;\r\n    }\r\n\r\n    let intervalo;\r\n    let delayInicial;\r\n\r\n    const consultarEstado = async () => {\r\n      try {\r\n        const res = await fetch(`${apiUrl}/pago/${reference}`);\r\n        if (!res.ok) {\r\n          if (res.status === 404) {\r\n            setEstado(\"NO_ENCONTRADO\");\r\n            toast.warn(\"⚠️ Referencia no encontrada\");\r\n          } else {\r\n            setErrorConsulta(true);\r\n            toast.error(\"❌ Error al consultar el estado del pago\");\r\n          }\r\n          clearInterval(intervalo);\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n        console.log(\"📥 Estado del pago:\", data.status);\r\n        console.log(\"🧾 Detalles del pago:\", data);\r\n\r\n        setEstado(data.status);\r\n        setPago(data);\r\n        setUltimaConsulta(new Date().toLocaleTimeString());\r\n\r\n        if (data.status !== \"PENDING\") {\r\n          clearInterval(intervalo);\r\n        }\r\n\r\n        // ✅ Toast según estado\r\n        if (data.status === \"APPROVED\") {\r\n          toast.success(\"✅ Pago aprobado\");\r\n        } else if (data.status === \"DECLINED\") {\r\n          toast.error(\"❌ Pago rechazado\");\r\n        } else if (data.status === \"PENDING\") {\r\n          toast.info(\"⏳ Pago en proceso\");\r\n        }\r\n\r\n      } catch (error) {\r\n        console.error(\"❌ Error en la consulta:\", error);\r\n        setErrorConsulta(true);\r\n        toast.error(\"❌ Error al consultar el estado del pago\");\r\n        clearInterval(intervalo);\r\n      }\r\n    };\r\n\r\n    delayInicial = setTimeout(() => {\r\n      consultarEstado();\r\n      intervalo = setInterval(consultarEstado, 3000);\r\n    }, 1500);\r\n\r\n    return () => {\r\n      clearInterval(intervalo);\r\n      clearTimeout(delayInicial);\r\n    };\r\n  }, [reference, apiUrl]);\r\n\r\n  const renderEstado = () => {\r\n    if (errorConsulta) {\r\n      return <h2 style={{ color: \"crimson\" }}>🚨 Error al consultar el estado del pago</h2>;\r\n    }\r\n\r\n    switch (estado) {\r\n      case \"APPROVED\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"green\" }}>🎉 ¡Pago aprobado!</h2>\r\n            <p>Gracias por tu compra.</p>\r\n            <ResumenPago pago={pago} />\r\n          </div>\r\n        );\r\n\r\n      case \"DECLINED\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"red\" }}>❌ Transacción rechazada</h2>\r\n            <p>Por favor intenta nuevamente con otro banco.</p>\r\n          </div>\r\n        );\r\n\r\n      case \"PENDING\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"orange\" }}>⏳ Esperando confirmación del banco…</h2>\r\n            <div className=\"spinner\" style={{\r\n              margin: \"1rem auto\",\r\n              width: \"40px\",\r\n              height: \"40px\",\r\n              border: \"4px solid #ccc\",\r\n              borderTop: \"4px solid orange\",\r\n              borderRadius: \"50%\",\r\n              animation: \"spin 1s linear infinite\"\r\n            }} />\r\n          </div>\r\n        );\r\n\r\n      case \"NO_ENCONTRADO\":\r\n        return <h2 style={{ color: \"gray\" }}>⚠️ Referencia no encontrada</h2>;\r\n\r\n      case null:\r\n        return (\r\n          <div>\r\n            <h2>🔍 Consultando estado del pago…</h2>\r\n            <div className=\"spinner\" />\r\n          </div>\r\n        );\r\n\r\n      default:\r\n        return <h2 style={{ color: \"gray\" }}>📌 Estado desconocido: {estado}</h2>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: \"2rem\", textAlign: \"center\" }}>\r\n      <h1>🧾 Estado del Pago</h1>\r\n      <p>Referencia: <strong>{reference}</strong></p>\r\n\r\n      <div aria-live=\"polite\" role=\"status\">\r\n        {renderEstado()}\r\n      </div>\r\n\r\n      {ultimaConsulta && (\r\n        <p style={{ fontSize: \"0.85rem\", color: \"#666\", marginTop: \"0.5rem\" }}>\r\n          Última verificación: {ultimaConsulta}\r\n        </p>\r\n      )}\r\n\r\n      <button\r\n        onClick={() => navigate(\"/\")}\r\n        style={{\r\n          marginTop: \"1.5rem\",\r\n          padding: \"10px 20px\",\r\n          cursor: \"pointer\"\r\n        }}\r\n      >\r\n        🔙 Volver a la tienda\r\n      </button>\r\n\r\n      <style>{`\r\n        @keyframes spin {\r\n          0% { transform: rotate(0deg); }\r\n          100% { transform: rotate(360deg); }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EstadoPago;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}