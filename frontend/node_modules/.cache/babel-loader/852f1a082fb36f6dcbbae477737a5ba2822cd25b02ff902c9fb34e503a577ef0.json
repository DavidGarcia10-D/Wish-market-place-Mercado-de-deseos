{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import ResumenPago from\"./ResumenPago\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const EstadoPago=_ref=>{let{apiUrl}=_ref;const{reference}=useParams();const navigate=useNavigate();const[estado,setEstado]=useState(null);const[ultimaConsulta,setUltimaConsulta]=useState(null);const[errorConsulta,setErrorConsulta]=useState(false);const[pago,setPago]=useState(null);// üßæ Detalles completos del pago\nuseEffect(()=>{if(!apiUrl){console.warn(\"‚ö†Ô∏è apiUrl no est√° definido en EstadoPago\");return;}let intervalo;let delayInicial;const consultarEstado=async()=>{try{const res=await fetch(\"\".concat(apiUrl,\"/pago/\").concat(reference));if(!res.ok){if(res.status===404)setEstado(\"NO_ENCONTRADO\");else setErrorConsulta(true);clearInterval(intervalo);return;}const data=await res.json();setEstado(data.status);setPago(data);// üßæ Guardamos todo el objeto del pago\nsetUltimaConsulta(new Date().toLocaleTimeString());if(data.status!==\"PENDING\")clearInterval(intervalo);}catch(error){console.error(\"‚ùå Error en la consulta:\",error);setErrorConsulta(true);clearInterval(intervalo);}};delayInicial=setTimeout(()=>{consultarEstado();intervalo=setInterval(consultarEstado,3000);},1500);return()=>{clearInterval(intervalo);clearTimeout(delayInicial);};},[reference,apiUrl]);const renderEstado=()=>{if(errorConsulta){return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"crimson\"},children:\"\\uD83D\\uDEA8 Error al consultar el estado del pago\"});}switch(estado){case\"APPROVED\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"green\"},children:\"\\uD83C\\uDF89 \\xA1Pago aprobado!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Gracias por tu compra.\"}),/*#__PURE__*/_jsx(ResumenPago,{pago:pago})]});case\"DECLINED\":return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{style:{color:\"red\"},children:\"\\u274C Transacci\\xF3n rechazada\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Por favor intenta nuevamente con otro banco.\"})]});case\"PENDING\":return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"orange\"},children:\"\\u23F3 Esperando confirmaci\\xF3n del banco\\u2026\"});case\"NO_ENCONTRADO\":return/*#__PURE__*/_jsx(\"h2\",{style:{color:\"gray\"},children:\"\\u26A0\\uFE0F Referencia no encontrada\"});case null:return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDD0D Consultando estado del pago\\u2026\"}),/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})]});default:return/*#__PURE__*/_jsxs(\"h2\",{style:{color:\"gray\"},children:[\"\\uD83D\\uDCCC Estado desconocido: \",estado]});}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:\"2rem\",textAlign:\"center\"},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\uD83E\\uDDFE Estado del Pago\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Referencia: \",/*#__PURE__*/_jsx(\"strong\",{children:reference})]}),/*#__PURE__*/_jsx(\"div\",{\"aria-live\":\"polite\",role:\"status\",children:renderEstado()}),ultimaConsulta&&/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:\"0.85rem\",color:\"#666\",marginTop:\"0.5rem\"},children:[\"\\xDAltima verificaci\\xF3n: \",ultimaConsulta]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/\"),style:{marginTop:\"1.5rem\",padding:\"10px 20px\",cursor:\"pointer\"},children:\"\\uD83D\\uDD19 Volver a la tienda\"})]});};export default EstadoPago;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","ResumenPago","jsx","_jsx","jsxs","_jsxs","EstadoPago","_ref","apiUrl","reference","navigate","estado","setEstado","ultimaConsulta","setUltimaConsulta","errorConsulta","setErrorConsulta","pago","setPago","console","warn","intervalo","delayInicial","consultarEstado","res","fetch","concat","ok","status","clearInterval","data","json","Date","toLocaleTimeString","error","setTimeout","setInterval","clearTimeout","renderEstado","style","color","children","className","padding","textAlign","role","fontSize","marginTop","onClick","cursor"],"sources":["C:/Users/David/Desktop/mi-proyecto/frontend/src/components/EstadoPago.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport ResumenPago from \"./ResumenPago\";\r\n\r\nconst EstadoPago = ({ apiUrl }) => {\r\n  const { reference } = useParams();\r\n  const navigate = useNavigate();\r\n  const [estado, setEstado] = useState(null);\r\n  const [ultimaConsulta, setUltimaConsulta] = useState(null);\r\n  const [errorConsulta, setErrorConsulta] = useState(false);\r\n  const [pago, setPago] = useState(null); // üßæ Detalles completos del pago\r\n\r\n  useEffect(() => {\r\n    if (!apiUrl) {\r\n      console.warn(\"‚ö†Ô∏è apiUrl no est√° definido en EstadoPago\");\r\n      return;\r\n    }\r\n\r\n    let intervalo;\r\n    let delayInicial;\r\n\r\n    const consultarEstado = async () => {\r\n      try {\r\n        const res = await fetch(`${apiUrl}/pago/${reference}`);\r\n        if (!res.ok) {\r\n          if (res.status === 404) setEstado(\"NO_ENCONTRADO\");\r\n          else setErrorConsulta(true);\r\n          clearInterval(intervalo);\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n        setEstado(data.status);\r\n        setPago(data); // üßæ Guardamos todo el objeto del pago\r\n        setUltimaConsulta(new Date().toLocaleTimeString());\r\n        if (data.status !== \"PENDING\") clearInterval(intervalo);\r\n      } catch (error) {\r\n        console.error(\"‚ùå Error en la consulta:\", error);\r\n        setErrorConsulta(true);\r\n        clearInterval(intervalo);\r\n      }\r\n    };\r\n\r\n    delayInicial = setTimeout(() => {\r\n      consultarEstado();\r\n      intervalo = setInterval(consultarEstado, 3000);\r\n    }, 1500);\r\n\r\n    return () => {\r\n      clearInterval(intervalo);\r\n      clearTimeout(delayInicial);\r\n    };\r\n  }, [reference, apiUrl]);\r\n\r\n  const renderEstado = () => {\r\n    if (errorConsulta) {\r\n      return <h2 style={{ color: \"crimson\" }}>üö® Error al consultar el estado del pago</h2>;\r\n    }\r\n\r\n    switch (estado) {\r\n      case \"APPROVED\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"green\" }}>üéâ ¬°Pago aprobado!</h2>\r\n            <p>Gracias por tu compra.</p>\r\n            <ResumenPago pago={pago} />\r\n          </div>\r\n        );\r\n\r\n      case \"DECLINED\":\r\n        return (\r\n          <div>\r\n            <h2 style={{ color: \"red\" }}>‚ùå Transacci√≥n rechazada</h2>\r\n            <p>Por favor intenta nuevamente con otro banco.</p>\r\n          </div>\r\n        );\r\n\r\n      case \"PENDING\":\r\n        return <h2 style={{ color: \"orange\" }}>‚è≥ Esperando confirmaci√≥n del banco‚Ä¶</h2>;\r\n\r\n      case \"NO_ENCONTRADO\":\r\n        return <h2 style={{ color: \"gray\" }}>‚ö†Ô∏è Referencia no encontrada</h2>;\r\n\r\n      case null:\r\n        return (\r\n          <div>\r\n            <h2>üîç Consultando estado del pago‚Ä¶</h2>\r\n            <div className=\"spinner\" />\r\n          </div>\r\n        );\r\n\r\n      default:\r\n        return <h2 style={{ color: \"gray\" }}>üìå Estado desconocido: {estado}</h2>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ padding: \"2rem\", textAlign: \"center\" }}>\r\n      <h1>üßæ Estado del Pago</h1>\r\n      <p>Referencia: <strong>{reference}</strong></p>\r\n\r\n      <div aria-live=\"polite\" role=\"status\">\r\n        {renderEstado()}\r\n      </div>\r\n\r\n      {ultimaConsulta && (\r\n        <p style={{ fontSize: \"0.85rem\", color: \"#666\", marginTop: \"0.5rem\" }}>\r\n          √öltima verificaci√≥n: {ultimaConsulta}\r\n        </p>\r\n      )}\r\n\r\n      <button\r\n        onClick={() => navigate(\"/\")}\r\n        style={{\r\n          marginTop: \"1.5rem\",\r\n          padding: \"10px 20px\",\r\n          cursor: \"pointer\"\r\n        }}\r\n      >\r\n        üîô Volver a la tienda\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EstadoPago;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}